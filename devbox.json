{   "$schema": "https://raw.githubusercontent.com/jetify-com/devbox/0.16.0/.schema/devbox.schema.json",   "packages": [     "ruby@3.3.2",     "nodejs@18.17.0",     "yarn@1.22.19",     "postgresql@15.7",     "libyaml@latest",     "libyaml.dev",     "pkg-config@latest",     "gcc@latest",     "gnumake@latest",     "solr_8@latest",     "zookeeper@latest",     "jdk11@latest",     "git@latest",     "chromedriver@latest",     "bash@latest",     "zsh@latest"   ],   "env": {     "DEVBOX": "1",     "PATH": "$PWD/.devbox/virtenv/ruby/bin:$PWD/.devbox/nix/profile/default/bin:$PATH",     "TMPDIR": "$PWD/.tmp",     "BUNDLER_VERSION": "2.5.9",     "PKG_CONFIG_PATH": "$PWD/.devbox/nix/profile/default/lib/pkgconfig:$PWD/.devbox/nix/profile/default/share/pkgconfig",     "BUNDLE_BUILD__PSYCH": "--with-libyaml-dir=$PWD/.devbox/nix/profile/default --with-pkg-config=$PWD/.devbox/nix/profile/default/bin/pkg-config",     "PGDATA": "$PWD/.postgres/data",     "PGHOST": "$PWD/.postgres",     "PGPORT": "5432",     "PGUSER": "$USER",     "PGDATABASE": "pdc_discovery_dev",     "PGPASSWORD": "",     "APP_DB_PORT": "5432",     "APP_DB_HOST": "$PWD/.postgres",     "APP_DB_USERNAME": "$USER",     "APP_DB_PASSWORD": "",     "APP_DB": "pdc_discovery_dev",     "DEVBOX_PGHOST": "$PWD/.postgres",     "DEVBOX_PGPORT": "5432",     "DEVBOX_PGUSER": "$USER",     "DEVBOX_PGDATABASE": "pdc_discovery_dev",     "DEVBOX_PGPASSWORD": "",     "SOLR_PORT": "8983",     "SOLR_BASE": "$PWD/.solr",     "SOLR_SERVER": "$PWD/.solr/server",     "SOLR_HOME": "$PWD/.solr/home",     "SOLR_LOGS_DIR": "$PWD/.solr/logs",     "SOLR_PID_DIR": "$PWD/.solr/pids",     "SOLR_HOST": "127.0.0.1",     "SOLR_URL": "http://127.0.0.1:8983/solr/pdc-core-dev",     "SOLR_OPTS": "-Dlog4j2.disable.jmx=true -Dsolr.disable.jmx=true -Dsolr.log.dir=$PWD/.solr/logs -Dsolr.pid.dir=$PWD/.solr/pids",     "SOLR_ULIMIT_CHECKS": "false"   },   "shell": {     "init_hook": [       "bundle config set --local build.psych \"--with-libyaml-dir=$PWD/.devbox/nix/profile/default --with-pkg-config=$PWD/.devbox/nix/profile/default/bin/pkg-config\" >/dev/null 2>&1 || true",       "gem install -N bundler -v \"$BUNDLER_VERSION\" >/dev/null 2>&1 || true",       "bundle _${BUNDLER_VERSION}_ install",       "yarn install",       "mkdir -p \"$PWD/.tmp\" \"$PWD/.postgres\" \"$SOLR_HOME\" \"$SOLR_LOGS_DIR\" \"$SOLR_PID_DIR\"",       "bash -c 'SOLR_BIN_REAL=\"$(readlink -f \"$(command -v solr)\")\"; SOLR_DIST=\"$(dirname \"$(dirname \"$SOLR_BIN_REAL\")\")\"; mkdir -p \"$SOLR_HOME\" \"$SOLR_LOGS_DIR\" \"$SOLR_PID_DIR\"; if [ ! -f \"$SOLR_HOME/solr.xml\" ]; then cp \"$SOLR_DIST/server/solr/solr.xml\" \"$SOLR_HOME/solr.xml\"; cp \"$SOLR_DIST/server/solr/zoo.cfg\" \"$SOLR_HOME/zoo.cfg\"; cp -R \"$SOLR_DIST/server/solr/configsets\" \"$SOLR_HOME/configsets\"; fi; chmod -R u+rwX \"$SOLR_HOME\" \"$SOLR_LOGS_DIR\" \"$SOLR_PID_DIR\"'",       "bash -c 'mkdir -p \"$(dirname \"$PGDATA\")\"; test -d \"$PGDATA\" || initdb -D \"$PGDATA\" -A trust'"     ],     "scripts": {       "setup": [         "bundle install",         "yarn install"       ],       "postgres-start": "bash -c 'set -e; mkdir -p \"$PGHOST\"; pg_ctl -D \"$PGDATA\" -l \"$PGHOST/postgres.log\" -o \"-k \\\"$PGHOST\\\" -p $PGPORT -c listen_addresses=\" start'",       "postgres-stop": "pg_ctl -D \"$PGDATA\" -m fast stop || true",       "postgres-status": "pg_ctl -D \"$PGDATA\" status || true",       "postgres-log": "tail -200 \"$PWD/.postgres/postgres.log\" || true",       "postgres-ensure": "bash -c '\nset -e\nmkdir -p \"$PGDATA\" \"$PGHOST\"\npg_isready -h \"$PGHOST\" -p \"$PGPORT\" >/dev/null 2>&1 && exit 0\nPIDFILE=\"$PGDATA/postmaster.pid\"\nif [ -f \"$PIDFILE\" ]; then\n  PID=$(head -1 \"$PIDFILE\" || true)\n  if [ -n \"$PID\" ] && ! kill -0 \"$PID\" 2>/dev/null; then\n    rm -f \"$PIDFILE\"\n  fi\nfi\npg_ctl -D \"$PGDATA\" -l \"$PWD/.postgres/postgres.log\" -o \"-p $PGPORT -k $PGHOST -c listen_addresses=\" start\nfor i in $(seq 1 50); do\n  pg_isready -h \"$PGHOST\" -p \"$PGPORT\" >/dev/null 2>&1 && exit 0\n  sleep 0.1\ndone\necho \"Postgres did not become ready\" >&2\ntail -200 \"$PWD/.postgres/postgres.log\" || true\nexit 1\n'",       "db-create": "devbox run postgres-ensure >/dev/null && bundle _${BUNDLER_VERSION}_ exec rails db:create",       "db-migrate": "devbox run postgres-ensure >/dev/null && bundle _${BUNDLER_VERSION}_ exec rails db:migrate",       "solr-log": "bash -c 'ls -al \"$SOLR_LOGS_DIR\" || true; tail -200 \"$SOLR_LOGS_DIR\"/*.log 2>/dev/null || true'",       "solr-start": "bash -c 'set -e; OS=$(uname -s); EXTRA=\"\"; if [ \"$OS\" != \"Darwin\" ]; then EXTRA=\"-XX:-UseContainerSupport\"; fi; if [ \"$OS\" = \"Darwin\" ]; then env -u JAVA_TOOL_OPTIONS JAVA_TOOL_OPTIONS=\"-Dlog4j2.disable.jmx=true -Dsolr.disable.jmx=true\" solr start -p \"$SOLR_PORT\" -s \"$SOLR_HOME\" -a \"$SOLR_OPTS\"; else JAVA_TOOL_OPTIONS=\"-Dlog4j2.disable.jmx=true -Dsolr.disable.jmx=true $EXTRA\" solr start -p \"$SOLR_PORT\" -s \"$SOLR_HOME\" -a \"$SOLR_OPTS $EXTRA\"; fi'",       "solr-stop": "bash -c 'OS=$(uname -s); EXTRA=\"\"; if [ \"$OS\" != \"Darwin\" ]; then EXTRA=\"-XX:-UseContainerSupport\"; fi; if [ \"$OS\" = \"Darwin\" ]; then env -u JAVA_TOOL_OPTIONS solr stop -p \"$SOLR_PORT\" || true; else JAVA_TOOL_OPTIONS=\"-Dlog4j2.disable.jmx=true -Dsolr.disable.jmx=true $EXTRA\" solr stop -p \"$SOLR_PORT\" || true; fi'",       "solr-status": "bash -c 'OS=$(uname -s); EXTRA=\"\"; if [ \"$OS\" != \"Darwin\" ]; then EXTRA=\"-XX:-UseContainerSupport\"; fi; JAVA_TOOL_OPTIONS=\"-Dlog4j2.disable.jmx=true -Dsolr.disable.jmx=true $EXTRA\" solr status -p \"$SOLR_PORT\" || true; ss -ltn 2>/dev/null | grep \":$SOLR_PORT\" || true'",       "solr-create-core": "bash -c 'set -e; OS=$(uname -s); EXTRA=\"\"; if [ \"$OS\" != \"Darwin\" ]; then EXTRA=\"-XX:-UseContainerSupport\"; fi; CORE=pdc-core-dev; if curl -fsS \"http://$SOLR_HOST:$SOLR_PORT/solr/$CORE/admin/ping?wt=json\" >/dev/null 2>&1; then echo \"Core $CORE already exists\"; else JAVA_TOOL_OPTIONS=\"-Dlog4j2.disable.jmx=true -Dsolr.disable.jmx=true $EXTRA\" solr create -p \"$SOLR_PORT\" -s \"$SOLR_HOME\" -c \"$CORE\" -d \"$PWD/solr/conf\"; fi'",       "zsh": "zsh -l"     }   } }
