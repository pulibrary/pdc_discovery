{
  "$schema": "https://raw.githubusercontent.com/jetify-com/devbox/0.16.0/.schema/devbox.schema.json",
  "packages": [
    "ruby@3.3.2",
    "nodejs@18.17.0",
    "yarn@1.22.19",
    "postgresql@15.7",
    "libyaml@latest",
    "libyaml.dev",
    "pkg-config@latest",
    "gcc@latest",
    "gnumake@latest",
    "jdk11@latest",
    "jq@latest",
    "git@latest",
    "chromedriver@latest",
    "bash@latest",
    "zsh@latest"
  ],
  "env": {
    "DEVBOX": "1",
    "DEVBOX_BIN": "$PWD/.devbox/nix/profile/default/bin",
    "PATH": "$PWD/.devbox/nix/profile/default/bin:$PATH",
    "TMPDIR": "$PWD/.tmp",
    "BUNDLER_VERSION": "2.5.9",
    "PKG_CONFIG_PATH": "$PWD/.devbox/nix/profile/default/lib/pkgconfig:$PWD/.devbox/nix/profile/default/share/pkgconfig",
    "BUNDLE_BUILD__PSYCH": "--with-libyaml-dir=$PWD/.devbox/nix/profile/default --with-pkg-config=$PWD/.devbox/nix/profile/default/bin/pkg-config",
    "PGDATA": "$PWD/.postgres/data",
    "PGHOST": "$PWD/.postgres",
    "PGPORT": "5432",
    "PGUSER": "$USER",
    "PGDATABASE": "pdc_discovery_dev",
    "PGPASSWORD": "",
    "APP_DB_PORT": "5432",
    "APP_DB_HOST": "$PWD/.postgres",
    "APP_DB_USERNAME": "$USER",
    "APP_DB_PASSWORD": "",
    "APP_DB": "pdc_discovery_dev",
    "DEVBOX_PGHOST": "$PWD/.postgres",
    "DEVBOX_PGPORT": "5432",
    "DEVBOX_PGUSER": "$USER",
    "DEVBOX_PGDATABASE": "pdc_discovery_dev",
    "DEVBOX_PGPASSWORD": ""
  },
  "shell": {
    "init_hook": [
      "echo 'initializing devbox'",
      "bash -c 'mkdir -p \"$(dirname \"$PGDATA\")\"; test -d \"$PGDATA\" || initdb -D \"$PGDATA\" -A trust'"
    ],
    "profile": {
      "bash": ["export PATH=\"$PWD/.devbox/nix/profile/default/bin:$PATH\""],
      "zsh": ["export PATH=\"$PWD/.devbox/nix/profile/default/bin:$PATH\""]
    },
    "scripts": {
      "setup": ["devbox run deps"],
      "deps": "bash -c 'set -euo pipefail; export PATH=\"$DEVBOX_BIN:$PATH\"; ruby -v; which ruby; gem install -N bundler -v \"$BUNDLER_VERSION\" >/dev/null 2>&1 || true; bundle _${BUNDLER_VERSION}_ install; yarn install'",
      "postgres-start": "bash -c 'set -e; mkdir -p \"$PGHOST\"; pg_ctl -D \"$PGDATA\" -l \"$PGHOST/postgres.log\" -o \"-k \\\"$PGHOST\\\" -p $PGPORT -c listen_addresses=\" start'",
      "postgres-stop": "pg_ctl -D \"$PGDATA\" -m fast stop || true",
      "postgres-status": "pg_ctl -D \"$PGDATA\" status || true",
      "postgres-log": "tail -200 \"$PWD/.postgres/postgres.log\" || true",
      "postgres-ensure": "bash -c '\nset -e\nmkdir -p \"$PGDATA\" \"$PGHOST\"\npg_isready -h \"$PGHOST\" -p \"$PGPORT\" >/dev/null 2>&1 && exit 0\nPIDFILE=\"$PGDATA/postmaster.pid\"\nif [ -f \"$PIDFILE\" ]; then\n  PID=$(head -1 \"$PIDFILE\" || true)\n  if [ -n \"$PID\" ] && ! kill -0 \"$PID\" 2>/dev/null; then\n    rm -f \"$PIDFILE\"\n  fi\nfi\npg_ctl -D \"$PGDATA\" -l \"$PWD/.postgres/postgres.log\" -o \"-p $PGPORT -k $PGHOST -c listen_addresses=\" start\nfor i in $(seq 1 50); do\n  pg_isready -h \"$PGHOST\" -p \"$PGPORT\" >/dev/null 2>&1 && exit 0\n  sleep 0.1\ndone\necho \"Postgres did not become ready\" >&2\ntail -200 \"$PWD/.postgres/postgres.log\" || true\nexit 1\n'",
      "db-create": "bash -c 'set -euo pipefail; export PATH=\"$DEVBOX_BIN:$PATH\"; devbox run postgres-ensure >/dev/null; bundle _${BUNDLER_VERSION}_ exec rails db:create'",
      "db-migrate": "bash -c 'set -euo pipefail; export PATH=\"$DEVBOX_BIN:$PATH\"; devbox run postgres-ensure >/dev/null; bundle _${BUNDLER_VERSION}_ exec rails db:migrate'",
      "zsh": "zsh -l"
    }
  }
}