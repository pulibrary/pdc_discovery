<section class="document-downloads-section">
  <div>
    <div class="card">
      <div class="document-downloads card-body">

        <!-- Only render file download table if there are files in DataSpace -->

        <% if @document.embargoed? %>
          <%= render_embargo_files(@document.embargo_date) %>
        <%elsif @document.files.empty? %>
          <%= render_empty_files %>
        <% else %>
          <table id="files-table" class="table">
            <thead>
              <tr>
                  <th>Name</th>
                  <th>Size</th>
              </tr>
            </thead>
            <tbody></tbody>
            <tfoot>
              <tr>
                  <th>Name</th>
                  <th>Size</th>
              </tr>
            </tfood>
          </table>
        <% end %>

        <!-- End of file download table -->

        <%= render_globus_download(@document.globus_uri, @document.id) %>
      </div>
    </div>
  </div>
</section>

<script type="text/javascript">
$(function() {

  $('#files-table').DataTable({
    ajax: "<%= catalog_file_list_path(@document) %>",
    columns: [
        { data: 'name' },
        { data: 'size' }
    ]
  });

  // Track file downloads via Plausible.
  $(".documents-file-link").click(function() {
    var filename = $(this).text();
    log_plausible_file_download(filename);
    return true;
  });

  // Track Globus downloads via Plausible.
  $(".globus-download-link").click(function() {
    var id = $(this).data('item-id');
    log_plausible_globus_download(id);
    return true;
  });
});
</script>
